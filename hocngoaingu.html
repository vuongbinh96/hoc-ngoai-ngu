<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LingoMusic - Learn Languages with Music</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body { font-family: 'Inter', 'Noto Sans KR', sans-serif; }
        .active-line { 
            background: linear-gradient(90deg, #dbeafe 0%, #ffffff 100%);
            color: #1e40af !important; 
            font-weight: 700; 
            border-left: 5px solid #2563eb;
            transform: scale(1.02);
        }
        .lyrics-line { transition: all 0.3s ease; }
        .custom-scrollbar::-webkit-scrollbar { width: 5px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        #player-inner { border-radius: 1.5rem; overflow: hidden; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25); }
    </style>
</head>
<body class="bg-[#f8fafc] text-slate-800">

    <nav class="bg-white/90 backdrop-blur-md sticky top-0 z-50 border-b border-slate-200 px-6 py-4">
        <div class="max-w-7xl mx-auto flex justify-between items-center">
            <div class="flex items-center gap-3">
                <div class="bg-blue-600 p-2 rounded-xl shadow-lg shadow-blue-200">
                    <i class="fas fa-play text-white"></i>
                </div>
                <h1 class="text-2xl font-black text-blue-600 tracking-tighter">LingoMusic</h1>
            </div>
            <div class="flex gap-4">
                <select id="langSelect" onchange="changeLanguage()" class="bg-slate-100 border-none rounded-lg px-4 py-2 text-sm font-semibold outline-none focus:ring-2 focus:ring-blue-500 cursor-pointer">
                    <option value="ko">Ti·∫øng H√†n (K-Pop) üá∞üá∑</option>
                    <option value="en">Ti·∫øng Anh (Pop) üá∫üá∏</option>
                </select>
            </div>
        </div>
    </nav>

    <main class="max-w-7xl mx-auto p-4 md:p-8">
        <div class="bg-white p-8 rounded-[2rem] shadow-sm border border-slate-200 mb-10">
            <h2 class="text-xl font-bold mb-5 flex items-center gap-3 text-slate-700">
                <i class="fas fa-link text-blue-500"></i> B·∫Øt ƒë·∫ßu b√†i h·ªçc m·ªõi
            </h2>
            <div class="flex flex-col md:flex-row gap-4">
                <input type="text" id="videoUrl" 
                       placeholder="D√°n link YouTube (V√≠ d·ª•: https://www.youtube.com/watch?v=k2qgadSvNyU)" 
                       class="flex-1 p-4 bg-slate-50 border border-slate-200 rounded-2xl focus:ring-2 focus:ring-blue-400 outline-none transition-all">
                <button onclick="handleLoadVideo()" class="bg-blue-600 hover:bg-blue-700 text-white px-10 py-4 rounded-2xl font-bold shadow-xl shadow-blue-100 transition-all flex items-center justify-center gap-2">
                    PH√ÇN T√çCH NH·∫†C
                </button>
            </div>
            <p id="errorMsg" class="text-red-500 text-sm mt-3 hidden italic"></p>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-10">
            <div class="lg:col-span-7 space-y-6">
                <div id="player-inner" class="aspect-video bg-black relative">
                    <div id="player"></div>
                </div>
                
                <div class="flex justify-between items-center bg-white p-6 rounded-3xl border border-slate-200 shadow-sm">
                    <div class="flex gap-4">
                        <button onclick="player.seekTo(player.getCurrentTime()-5)" class="w-12 h-12 rounded-full border border-slate-200 hover:bg-blue-50 text-blue-600 transition-all"><i class="fas fa-undo"></i></button>
                        <button onclick="togglePlay()" id="playIcon" class="w-12 h-12 rounded-full bg-blue-600 text-white hover:bg-blue-700 transition-all shadow-lg shadow-blue-100"><i class="fas fa-pause"></i></button>
                        <button onclick="player.seekTo(player.getCurrentTime()+5)" class="w-12 h-12 rounded-full border border-slate-200 hover:bg-blue-50 text-blue-600 transition-all"><i class="fas fa-redo"></i></button>
                    </div>
                    <div class="text-right">
                        <span class="text-sm text-slate-400 block uppercase font-bold tracking-widest">ƒêang ph√°t</span>
                        <span id="videoTitleDisplay" class="font-bold text-slate-700">T√™n b√†i h√°t s·∫Ω hi·ªán ·ªü ƒë√¢y</span>
                    </div>
                </div>
            </div>

            <div class="lg:col-span-5">
                <div class="bg-white rounded-[2rem] border border-slate-200 h-[600px] flex flex-col overflow-hidden shadow-sm">
                    <div class="p-6 border-b border-slate-100 flex justify-between items-center bg-slate-50/50">
                        <span class="font-bold text-slate-800 tracking-tight">L·ªúI B√ÄI H√ÅT T∆Ø∆†NG T√ÅC</span>
                        <span class="bg-blue-100 text-blue-600 text-[10px] font-black px-2 py-1 rounded-md">LIVE SYNC</span>
                    </div>
                    <div id="lyricsContainer" class="flex-1 overflow-y-auto p-6 space-y-4 custom-scrollbar">
                        </div>
                </div>
            </div>
        </div>
    </main>

    <script src="https://www.youtube.com/iframe_api"></script>
    <script>
        let player;
        let checkInterval;
        
        const dataSet = {
            en: [
                { s: 5, t: "One: Don't pick up the phone", v: "M·ªôt: ƒê·ª´ng nh·∫•c m√°y" },
                { s: 8, t: "You know he's only calling 'cause he's drunk and alone", v: "Bi·∫øt th·ª´a h·∫Øn ch·ªâ g·ªçi khi say v√† c√¥ ƒë∆°n" },
                { s: 13, t: "Two: Don't let him in", v: "Hai: ƒê·ª´ng ƒë·ªÉ h·∫Øn v√†o nh√†" },
                { s: 15, t: "You'll have to kick him out again", v: "B·∫°n s·∫Ω l·∫°i ph·∫£i ƒëu·ªïi h·∫Øn ƒëi th√¥i" }
            ],
            ko: [
                { s: 2, t: "Î≥¥Í≥† Ïã∂Îã§ (Bogo sipda)", v: "Anh nh·ªõ em" },
                { s: 5, t: "Ïù¥Î†áÍ≤å ÎßêÌïòÎãàÍπå Îçî Î≥¥Í≥† Ïã∂Îã§", v: "N√≥i ra th·∫ø n√†y l·∫°i c√†ng th·∫•y nh·ªõ h∆°n" },
                { s: 9, t: "ÎÑàÌù¨ ÏÇ¨ÏßÑÏùÑ Î≥¥Í≥† ÏûàÏñ¥ÎèÑ", v: "D√π ƒëang nh√¨n v√†o b·ª©c ·∫£nh c·ªßa em" },
                { s: 13, t: "Î≥¥Í≥† Ïã∂Îã§", v: "Th·ª±c s·ª± r·∫•t nh·ªõ em" }
            ]
        };

        function onYouTubeIframeAPIReady() {
            console.log("YouTube API Loaded");
        }

        function handleLoadVideo() {
            const url = document.getElementById('videoUrl').value;
            const id = extractId(url);
            const errorEl = document.getElementById('errorMsg');
            
            if (!id) {
                errorEl.innerText = "Link YouTube kh√¥ng h·ª£p l·ªá!";
                errorEl.classList.remove('hidden');
                return;
            }

            errorEl.classList.add('hidden');
            if (player) player.destroy();

            player = new YT.Player('player', {
                videoId: id,
                playerVars: {
                    'origin': window.location.origin, // S·ª≠a l·ªói 153
                    'enablejsapi': 1,
                    'modestbranding': 1,
                    'rel': 0
                },
                events: {
                    'onReady': (e) => {
                        document.getElementById('videoTitleDisplay').innerText = e.target.getVideoData().title;
                        renderLyrics();
                        e.target.playVideo();
                    },
                    'onStateChange': onPlayerStateChange,
                    'onError': (e) => {
                        let msg = "L·ªói 153: Video n√†y ch·∫∑n ph√°t b√™n ngo√†i. H√£y ch·ªçn b·∫£n 'Lyric Video' ho·∫∑c 'Cover'!";
                        errorEl.innerText = msg;
                        errorEl.classList.remove('hidden');
                    }
                }
            });
        }

        function renderLyrics() {
            const lang = document.getElementById('langSelect').value;
            const container = document.getElementById('lyricsContainer');
            container.innerHTML = dataSet[lang].map((l, i) => `
                <div id="line-${i}" onclick="player.seekTo(${l.s})" class="lyrics-line p-5 rounded-2xl border border-transparent hover:border-blue-100 cursor-pointer group">
                    <p class="text-xs font-mono text-slate-300 mb-1 group-hover:text-blue-400">${formatTime(l.s)}</p>
                    <p class="text-lg font-semibold text-slate-800 mb-1">${l.t}</p>
                    <p class="text-sm text-slate-500">${l.v}</p>
                </div>
            `).join('');
        }

        function onPlayerStateChange(event) {
            if (event.data == YT.PlayerState.PLAYING) {
                document.getElementById('playIcon').innerHTML = '<i class="fas fa-pause"></i>';
                startSync();
            } else {
                document.getElementById('playIcon').innerHTML = '<i class="fas fa-play"></i>';
                clearInterval(checkInterval);
            }
        }

        function startSync() {
            const lang = document.getElementById('langSelect').value;
            checkInterval = setInterval(() => {
                const now = player.getCurrentTime();
                dataSet[lang].forEach((line, i) => {
                    const el = document.getElementById(`line-${i}`);
                    if (now >= line.s && (i === dataSet[lang].length - 1 || now < dataSet[lang][i+1].s)) {
                        if (!el.classList.contains('active-line')) {
                            document.querySelectorAll('.lyrics-line').forEach(l => l.classList.remove('active-line'));
                            el.classList.add('active-line');
                            el.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        }
                    }
                });
            }, 300);
        }

        function extractId(url) {
            const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/;
            const match = url.match(regExp);
            return (match && match[2].length == 11) ? match[2] : false;
        }

        function formatTime(s) { return new Date(s * 1000).toISOString().substr(14, 5); }
        function togglePlay() { player.getPlayerState() == 1 ? player.pauseVideo() : player.playVideo(); }
        function changeLanguage() { if (player) renderLyrics(); }
    </script>
</body>
</html>