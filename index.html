<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LingoPro - Pop-up Focus</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background: #f1f5f9; font-family: 'Inter', sans-serif; display: flex; flex-direction: column; min-height: 100vh; }
        
        /* Card chính chứa lời bài hát */
        .lyric-card { 
            background: white; border-radius: 40px; padding: 50px; 
            max-width: 800px; width: 90%; margin: 40px auto;
            box-shadow: 0 10px 30px rgba(0,0,0,0.05);
        }

        /* Chữ gốc: To, đậm, có thể nhấn */
        .source-word { 
            font-size: 3.5rem; font-weight: 900; color: #1e293b; 
            cursor: pointer; transition: 0.2s; display: inline-block;
            margin-right: 12px; letter-spacing: -0.05em;
        }
        .source-word:hover { color: #ef4444; transform: translateY(-3px); }

        /* Pop-up hình chữ nhật ở dưới */
        #translate-popup {
            position: fixed; bottom: -100px; left: 50%; transform: translateX(-50%);
            width: 90%; max-width: 500px; background: #1e293b; color: white;
            padding: 20px 40px; border-radius: 25px; display: flex;
            align-items: center; justify-content: center; gap: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3); transition: 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            z-index: 1000;
        }
        #translate-popup.active { bottom: 40px; }

        .popup-original { font-weight: 900; font-size: 1.5rem; color: #f87171; }
        .popup-divider { width: 2px; height: 25px; background: #475569; }
        .popup-viet { font-weight: 700; font-size: 1.5rem; }

        /* Nút nạp dữ liệu */
        .input-box { max-width: 600px; margin: 20px auto; width: 90%; }
    </style>
</head>
<body>

    <div class="text-center mt-10">
        <h1 class="text-3xl font-black italic text-slate-800">LINGO<span class="text-red-500">PRO</span></h1>
    </div>

    <div class="input-box bg-white p-6 rounded-[30px] shadow-sm">
        <textarea id="lyric-input" rows="2" class="w-full p-4 rounded-2xl bg-slate-50 border-none outline-none text-lg" placeholder="Dán câu tiếng Anh hoặc tiếng Hàn vào đây..."></textarea>
        <button onclick="renderLyrics()" class="w-full mt-3 bg-slate-900 text-white py-3 rounded-2xl font-bold uppercase tracking-widest hover:bg-red-500 transition">Học câu này</button>
    </div>

    <div id="display-area"></div>

    <div id="translate-popup">
        <span class="popup-original" id="pop-src">Word</span>
        <div class="popup-divider"></div>
        <span class="popup-viet" id="pop-vi">Nghĩa</span>
    </div>

    <script>
        async function renderLyrics() {
            const text = document.getElementById('lyric-input').value;
            if(!text) return;

            const displayArea = document.getElementById('display-area');
            displayArea.innerHTML = "";

            const lines = text.split('\n').filter(l => l.trim());
            
            lines.forEach((line, i) => {
                const card = document.createElement('div');
                card.className = 'lyric-card';
                
                const words = line.split(/\s+/);
                words.forEach(word => {
                    const span = document.createElement('span');
                    span.className = 'source-word';
                    span.innerText = word;
                    span.onclick = () => showPopup(word);
                    card.appendChild(span);
                });

                displayArea.appendChild(card);
            });
        }

        async function showPopup(word) {
            const popup = document.getElementById('translate-popup');
            const popSrc = document.getElementById('pop-src');
            const popVi = document.getElementById('pop-vi');

            // Xử lý làm sạch từ trước khi dịch (bỏ dấu câu)
            const cleanWord = word.replace(/[.,!?;]/g, "");
            
            // Gọi API dịch
            const res = await fetch(`https://translate.googleapis.com/translate_a/single?client=gtx&sl=auto&tl=vi&dt=t&q=${encodeURI(cleanWord)}`);
            const data = await res.json();
            const translated = data[0][0][0];

            // Cập nhật nội dung Pop-up
            popSrc.innerText = cleanWord;
            popVi.innerText = translated;

            // Hiện Pop-up
            popup.classList.add('active');

            // Tự động đóng sau 3 giây nếu không làm gì
            clearTimeout(window.popupTimer);
            window.popupTimer = setTimeout(() => {
                popup.classList.remove('active');
            }, 3500);
        }

        // Đóng popup khi nhấn ra ngoài
        document.addEventListener('click', (e) => {
            if(!e.target.classList.contains('source-word') && !document.getElementById('translate-popup').contains(e.target)) {
                document.getElementById('translate-popup').classList.remove('active');
            }
        });
    </script>
</body>
</html>
