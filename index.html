<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LingoPro - Word focus</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        body { background: #0f172a; font-family: 'Inter', sans-serif; color: white; height: 100vh; overflow: hidden; }
        
        /* Dropdown Ng√¥n ng·ªØ - M√†u ƒëen b·∫Øt bu·ªôc */
        #tts-lang {
            background-color: #ffffff !important;
            color: #000000 !important;
            border: 2px solid #334155;
            padding: 4px 12px;
            border-radius: 12px;
            font-weight: 800;
            font-size: 12px;
            outline: none;
        }
        #tts-lang option { color: #000000; background: #ffffff; }

        .lyric-card { background: white; border-radius: 20px; padding: 20px; margin-bottom: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.3); }
        
        /* Hi·ªáu ·ª©ng khi nh·∫•n v√†o t·ª´ */
        .source-word { 
            font-size: 1.25rem; font-weight: 700; color: #1e293b; 
            cursor: pointer; padding: 2px 4px; border-radius: 6px;
            transition: all 0.1s; display: inline-block;
        }
        .source-word:hover { background: #fee2e2; color: #ef4444; }
        .source-word:active { transform: scale(0.9); }

        .line-translation { color: #94a3b8; font-size: 0.85rem; margin-top: 8px; font-style: italic; }

        #translate-popup {
            position: fixed; bottom: -250px; left: 50%; transform: translateX(-50%);
            width: 92%; max-width: 400px; background: white; color: #1e293b; padding: 20px;
            border-radius: 25px; display: flex; align-items: center; justify-content: space-between;
            box-shadow: 0 -10px 40px rgba(0,0,0,0.5); transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1); 
            z-index: 1000; border: 3px solid #ef4444;
        }
        #translate-popup.active { bottom: 20px; }

        .btn-main { background: #2563eb; color: white; padding: 15px; border-radius: 15px; font-weight: 900; width: 100%; transition: 0.2s; }
        .btn-main:hover { background: #1d4ed8; }
        
        #lyric-display { height: calc(100vh - 150px); overflow-y: auto; padding: 10px; }
    </style>
</head>
<body class="p-4 md:p-6">

    <header class="flex justify-between items-center mb-6">
        <h1 class="text-2xl font-black italic">LINGO<span class="text-red-500">PRO</span></h1>
        <div class="flex items-center gap-3">
            <select id="tts-lang"></select>
            <button onclick="openQuiz()" class="bg-red-500 text-white px-5 py-2 rounded-full font-black text-[10px] shadow-lg">THI</button>
        </div>
    </header>

    <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
        <div class="lg:col-span-4 space-y-4">
            <div id="player-container" class="rounded-2xl overflow-hidden aspect-video bg-black shadow-2xl">
                <div id="player"></div>
            </div>
            
            <div class="space-y-2">
                <input type="text" id="yt-url" placeholder="D√°n link Youtube..." class="w-full p-3 rounded-xl bg-slate-800 border border-slate-700 text-sm">
                <textarea id="lyric-input" rows="5" class="w-full p-3 rounded-xl bg-slate-800 border border-slate-700 text-sm focus:border-red-500 outline-none" placeholder="[B·∫ÆT BU·ªòC] D√°n l·ªùi b√†i h√°t v√†o ƒë√¢y..."></textarea>
                <button onclick="initApp()" class="btn-main uppercase tracking-tighter">üöÄ N·∫°p b√†i h·ªçc ngay</button>
            </div>
        </div>

        <div class="lg:col-span-8">
            <div id="lyric-display" onmouseup="handleSelection()">
                <div class="h-full flex flex-col items-center justify-center opacity-30">
                    <i class="fa-solid fa-language text-6xl mb-2"></i>
                    <p>Nh·∫≠p Lyrics ƒë·ªÉ b·∫Øt ƒë·∫ßu d·ªãch t·ª´ng t·ª´</p>
                </div>
            </div>
        </div>
    </div>

    <div id="translate-popup">
        <div class="min-w-0 flex-1">
            <p id="pop-src" class="text-xs font-bold text-slate-400 uppercase mb-1">WORD</p>
            <p id="pop-vi" class="text-2xl font-black text-red-500 leading-tight">ƒêang d·ªãch...</p>
        </div>
        <button onclick="speakWord()" class="w-12 h-12 bg-red-500 text-white rounded-full shadow-lg active:scale-90 transition">
            <i class="fa-solid fa-volume-high"></i>
        </button>
    </div>

    <script src="https://www.youtube.com/iframe_api"></script>
    <script>
        const langs = {"en-US":"English","ko-KR":"Korean","ja-JP":"Japanese","vi-VN":"Vietnamese","zh-CN":"Chinese","fr-FR":"French"};
        let player, clickedWords = [], allWords = [], popupTimer;

        window.onload = () => {
            const s = document.getElementById('tts-lang');
            for(let k in langs) s.options[s.options.length] = new Option(langs[k], k);
        };

        function extractId(u) { const m = u.match(/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/); return (m&&m[2].length==11)?m[2]:false; }

        async function quickTranslate(t) {
            try {
                const res = await fetch(`https://translate.googleapis.com/translate_a/single?client=gtx&sl=auto&tl=vi&dt=t&q=${encodeURIComponent(t)}`);
                const d = await res.json();
                return d[0][0][0];
            } catch(e) { return "L·ªói"; }
        }

        function initApp() {
            const txt = document.getElementById('lyric-input').value.trim();
            if(!txt) return alert("B·∫°n ch∆∞a nh·∫≠p l·ªùi b√†i h√°t!");
            
            const vid = extractId(document.getElementById('yt-url').value);
            if(vid) {
                if(player) player.loadVideoById(vid);
                else player = new YT.Player('player', {videoId:vid, width:'100%', height:'100%'});
            }
            render(txt);
        }

        function render(txt) {
            const container = document.getElementById('lyric-display');
            container.innerHTML = ""; allWords = [];
            
            txt.split('\n').filter(l => l.trim()).forEach(line => {
                const card = document.createElement('div');
                card.className = 'lyric-card';
                
                const wordsWrap = document.createElement('div');
                // T√°ch t·ª´ nh∆∞ng gi·ªØ l·∫°i kho·∫£ng tr·∫Øng ƒë·ªÉ kh√¥ng b·ªã d√≠nh ch·ªØ
                const tokens = line.split(/(\s+)/); 

                tokens.forEach(token => {
                    if(/\s+/.test(token)) {
                        wordsWrap.appendChild(document.createTextNode(token));
                    } else {
                        const span = document.createElement('span');
                        span.className = 'source-word';
                        span.innerText = token;
                        
                        const clean = token.replace(/[.,!?;:'"‚Äú‚Äù]/g, "");
                        if(clean && !allWords.includes(clean)) allWords.push(clean);

                        span.onclick = (e) => {
                            e.stopPropagation();
                            showPop(clean);
                        };
                        wordsWrap.appendChild(span);
                    }
                });

                const sub = document.createElement('div');
                sub.className = 'line-translation';
                sub.innerText = "D·ªãch nhanh c√¢u n√†y...";
                
                card.appendChild(wordsWrap);
                card.appendChild(sub);
                container.appendChild(card);
                
                quickTranslate(line).then(r => sub.innerText = r);
            });
        }

        async function showPop(t) {
            const pop = document.getElementById('translate-popup');
            document.getElementById('pop-src').innerText = t;
            document.getElementById('pop-vi').innerText = "Tra t·ª´...";
            pop.classList.add('active');

            const res = await quickTranslate(t);
            document.getElementById('pop-vi').innerText = res;

            if(!clickedWords.find(i => i.q === t)) clickedWords.push({q:t, a:res});
            
            if(popupTimer) clearTimeout(popupTimer);
            popupTimer = setTimeout(() => pop.classList.remove('active'), 6000);
        }

        function speakWord() {
            const t = document.getElementById('pop-src').innerText;
            const u = new SpeechSynthesisUtterance(t);
            u.lang = /[\uAC00-\uD7A3]/.test(t) ? 'ko-KR' : document.getElementById('tts-lang').value;
            window.speechSynthesis.speak(u);
        }

        function handleSelection() {
            const s = window.getSelection().toString().trim();
            if(s.length > 1) showPop(s);
        }

        function openQuiz() {
            if(allWords.length < 2) return alert("N·∫°p b√†i h·ªçc tr∆∞·ªõc!");
            alert("T√≠nh nƒÉng thi ƒëang ƒë∆∞·ª£c t·ªëi ∆∞u cho t·ª´ v·ª±ng b·∫°n v·ª´a tra!");
            // Gi·ªØ nguy√™n logic quiz c≈© c·ªßa b·∫°n t·∫°i ƒë√¢y
        }
    </script>
</body>
</html>
