<!DOCTYPE html>
<html lang="vi" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LingoPro v14.0 | Enterprise Neural Workspace</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Plus+Jakarta+Sans:wght@300;400;600;800&display=swap" rel="stylesheet">

    <style>
        /* --- GLOBAL ROOT VARIABLES --- */
        :root {
            --primary-color: #6366f1;
            --primary-glow: rgba(99, 102, 241, 0.5);
            --secondary-color: #ec4899;
            --accent-success: #10b981;
            --bg-deep-slate: #020617;
            --bg-card-slate: #0f172a;
            --border-alpha: rgba(255, 255, 255, 0.08);
            --text-vibrant: #f1f5f9;
            --text-muted: #94a3b8;
        }

        /* --- BASE RESET & LAYOUT --- */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            outline: none;
        }

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: var(--bg-deep-slate);
            color: var(--text-vibrant);
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            -webkit-font-smoothing: antialiased;
        }

        /* --- CUSTOM SCROLLBAR SYSTEM --- */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.05);
        }

        ::-webkit-scrollbar-thumb {
            background: #1e293b;
            border-radius: 20px;
            border: 2px solid var(--bg-deep-slate);
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #334155;
        }

        /* --- UI COMPONENTS --- */
        .glass-panel {
            background: rgba(15, 23, 42, 0.85);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border-alpha);
        }

        .nav-link {
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .nav-link.active {
            color: #ffffff !important;
            background: var(--primary-color) !important;
            box-shadow: 0 8px 25px var(--primary-glow);
        }

        /* --- READER ENGINE STYLES --- */
        .word-unit {
            display: inline-block;
            cursor: pointer;
            padding: 2px 4px;
            margin: 0 1px;
            border-radius: 6px;
            transition: all 0.25s ease;
            position: relative;
        }

        .word-unit:hover {
            background: rgba(99, 102, 241, 0.15);
            color: var(--primary-color);
            transform: translateY(-2px) scale(1.05);
        }

        /* --- LEXICON GRID SYSTEM --- */
        .card-entry {
            background: var(--bg-card-slate);
            border: 1px solid var(--border-alpha);
            border-radius: 24px;
            padding: 24px;
            transition: all 0.4s ease;
            position: relative;
            overflow: hidden;
        }

        .card-entry:hover {
            border-color: var(--primary-color);
            transform: translateY(-8px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.4);
        }

        .card-entry::after {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            width: 5px;
            height: 100%;
            background: linear-gradient(to bottom, var(--primary-color), var(--secondary-color));
        }

        /* --- XP SYSTEM UI --- */
        .xp-container {
            height: 10px;
            background: #1e293b;
            border-radius: 100px;
            width: 150px;
            overflow: hidden;
            border: 1px solid rgba(255,255,255,0.05);
        }

        .xp-fill-active {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            width: 0%;
            transition: width 1s cubic-bezier(0.23, 1, 0.32, 1);
        }

        /* --- TAB MANAGEMENT --- */
        .pane {
            display: none;
            height: 100%;
            opacity: 0;
        }

        .pane.active {
            display: block;
            opacity: 1;
            animation: paneEntry 0.5s ease forwards;
        }

        @keyframes paneEntry {
            from { opacity: 0; transform: scale(0.98) translateY(10px); }
            to { opacity: 1; transform: scale(1) translateY(0); }
        }

        /* --- TOOLTIP & POPUPS --- */
        #smart-tooltip {
            position: fixed;
            display: none;
            z-index: 10000;
            background: var(--primary-color);
            color: white;
            padding: 10px 22px;
            border-radius: 50px;
            font-size: 12px;
            font-weight: 800;
            letter-spacing: 0.05em;
            cursor: pointer;
            box-shadow: 0 15px 35px rgba(0,0,0,0.4);
        }
    </style>
</head>
<body>

    <div id="smart-tooltip" onclick="engine.translatePhrase()">
        <i class="fa-solid fa-bolt-lightning mr-2"></i> ANALYZE PHRASE
    </div>

    <header class="h-24 border-b border-white/5 px-10 flex items-center justify-between glass-panel z-[500]">
        <div class="flex items-center gap-14">
            <div class="flex items-center gap-4 group cursor-pointer" onclick="location.reload()">
                <div class="w-12 h-12 bg-indigo-600 rounded-2xl flex items-center justify-center shadow-2xl group-hover:rotate-12 transition-all">
                    <i class="fa-solid fa-layer-group text-white text-xl"></i>
                </div>
                <div>
                    <h1 class="text-2xl font-black italic tracking-tighter">LINGOPRO <span class="text-indigo-500">v14</span></h1>
                    <p class="text-[9px] font-bold text-slate-500 uppercase tracking-[0.3em]">Neural Learning Environment</p>
                </div>
            </div>

            <nav class="flex items-center gap-3 bg-slate-900/40 p-2 rounded-2xl border border-white/5">
                <button onclick="router.navigate('reader')" class="nav-link active px-8 py-3 rounded-xl text-[11px] font-black uppercase tracking-widest" data-nav="reader">Workspace</button>
                <button onclick="router.navigate('lexicon')" class="nav-link px-8 py-3 rounded-xl text-[11px] font-black uppercase tracking-widest text-slate-400" data-nav="lexicon">Lexicon</button>
                <button onclick="router.navigate('storage')" class="nav-link px-8 py-3 rounded-xl text-[11px] font-black uppercase tracking-widest text-slate-400" data-nav="storage">Data Center</button>
            </nav>
        </div>

        <div class="flex items-center gap-8">
            <div class="flex flex-col items-end">
                <div class="flex items-center gap-3 mb-2">
                    <span id="display-level" class="bg-indigo-600/20 text-indigo-400 px-3 py-1 rounded-lg text-[10px] font-black">LEVEL 1</span>
                    <span id="display-rank" class="text-[10px] font-black text-slate-500 uppercase tracking-widest">Neophyte</span>
                </div>
                <div class="xp-container">
                    <div id="xp-bar-fill" class="xp-fill-active"></div>
                </div>
            </div>
            <div class="h-12 w-[1px] bg-white/10"></div>
            <div class="w-12 h-12 rounded-2xl bg-gradient-to-br from-slate-800 to-slate-900 flex items-center justify-center border border-white/5">
                <i class="fa-solid fa-user-ninja text-slate-500"></i>
            </div>
        </div>
    </header>

    <main class="flex-1 flex overflow-hidden">
        
        <aside class="w-[380px] border-r border-white/5 flex flex-col p-8 space-y-10 bg-slate-950/30 overflow-y-auto">
            
            <div class="space-y-6">
                <h3 class="text-[10px] font-black text-indigo-400 uppercase tracking-[0.25em] flex items-center gap-3">
                    <i class="fa-solid fa-terminal text-sm"></i> Intelligence Input
                </h3>
                
                <div class="space-y-4">
                    <div class="group">
                        <label class="text-[9px] font-bold text-slate-600 uppercase mb-2 block tracking-widest">Source Material</label>
                        <textarea id="input-area" rows="12" placeholder="Paste English text, articles, or transcripts here..." class="w-full bg-slate-900/50 border border-white/5 p-5 rounded-2xl text-xs focus:border-indigo-500 transition-all resize-none shadow-inner"></textarea>
                    </div>

                    <button onclick="engine.initAnalysis()" class="w-full bg-indigo-600 hover:bg-indigo-500 py-5 rounded-2xl font-black text-[11px] uppercase tracking-[0.2em] shadow-xl shadow-indigo-600/20 transition-all flex items-center justify-center gap-3">
                        <i class="fa-solid fa-microchip"></i> EXECUTE ENGINE (F8)
                    </button>
                </div>
            </div>

            <div class="p-6 bg-slate-900/50 rounded-3xl border border-white/5 space-y-4">
                <h4 class="text-[10px] font-black text-slate-500 uppercase">System Status</h4>
                <div class="space-y-3">
                    <div class="flex justify-between items-center">
                        <span class="text-[10px] text-slate-400">Database Linked</span>
                        <span class="text-[10px] font-bold text-emerald-500">ACTIVE</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-[10px] text-slate-400">File Output</span>
                        <span class="text-[10px] font-bold text-indigo-400">user.json</span>
                    </div>
                </div>
            </div>

        </aside>

        <section class="flex-1 relative flex flex-col">
            
            <div id="pane-reader" class="pane active flex flex-col">
                <div class="h-16 border-b border-white/5 px-10 flex items-center justify-between bg-slate-900/10">
                    <div class="flex items-center gap-4">
                        <div class="w-2 h-2 rounded-full bg-emerald-500 animate-pulse"></div>
                        <span class="text-[10px] font-black uppercase tracking-widest text-slate-400">Reader Mode Active</span>
                    </div>
                </div>
                
                <div id="content-output" class="flex-1 p-16 overflow-y-auto custom-scroll text-xl leading-[2.8] font-medium">
                    <div class="h-full flex flex-col items-center justify-center opacity-10">
                        <i class="fa-solid fa-wind text-8xl mb-6"></i>
                        <p class="font-black text-sm uppercase tracking-[0.5em]">Waiting for System Feed</p>
                    </div>
                </div>
            </div>

            <div id="pane-lexicon" class="pane p-16 overflow-y-auto custom-scroll">
                <div class="max-w-6xl mx-auto">
                    <div class="flex justify-between items-end mb-16">
                        <div>
                            <h2 class="text-6xl font-black italic tracking-tighter uppercase mb-4">Lexicon</h2>
                            <p class="text-slate-500 text-[11px] font-bold uppercase tracking-[0.3em]">Total Synchronized Terms: <span id="count-total" class="text-white">0</span></p>
                        </div>
                    </div>
                    <div id="lexicon-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                        </div>
                </div>
            </div>

            <div id="pane-storage" class="pane p-16 overflow-y-auto custom-scroll">
                <div class="max-w-4xl mx-auto">
                    <h2 class="text-6xl font-black italic uppercase mb-16">Storage</h2>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-10">
                        <div class="card-entry p-10">
                            <h3 class="text-lg font-black uppercase mb-6 flex items-center gap-4">
                                <i class="fa-solid fa-file-export text-indigo-500"></i> Export Engine
                            </h3>
                            <p class="text-xs text-slate-500 mb-10 leading-relaxed">
                                Đóng gói toàn bộ cơ sở dữ liệu học tập vào file <strong>user.json</strong> để lưu trữ ngoại tuyến hoặc chuyển thiết bị.
                            </p>
                            <button onclick="storage.downloadData()" class="w-full bg-indigo-600/10 border border-indigo-500/20 text-indigo-400 py-5 rounded-2xl text-[11px] font-black uppercase hover:bg-indigo-600 hover:text-white transition-all">
                                Generate user.json
                            </button>
                        </div>

                        <div class="card-entry p-10">
                            <h3 class="text-lg font-black uppercase mb-6 flex items-center gap-4">
                                <i class="fa-solid fa-file-import text-emerald-500"></i> Import Engine
                            </h3>
                            <p class="text-xs text-slate-500 mb-10 leading-relaxed">
                                Khôi phục tiến trình từ file <strong>user.json</strong> hiện có. Hệ thống sẽ tự động đồng bộ hóa mọi từ vựng cũ.
                            </p>
                            <input type="file" id="file-input" class="hidden" onchange="storage.uploadData(event)">
                            <button onclick="document.getElementById('file-input').click()" class="w-full bg-emerald-600/10 border border-emerald-500/20 text-emerald-400 py-5 rounded-2xl text-[11px] font-black uppercase hover:bg-emerald-600 hover:text-white transition-all">
                                Select user.json
                            </button>
                        </div>
                    </div>
                </div>
            </div>

        </section>
    </main>

    <div id="translation-pop" class="fixed bottom-[-600px] left-1/2 -translate-x-1/2 w-full max-w-2xl glass-panel p-12 rounded-[50px] shadow-[0_50px_100px_rgba(0,0,0,0.7)] border-t-4 border-indigo-600 transition-all duration-700 z-[2000]">
        <div class="flex justify-between items-start gap-10">
            <div class="flex-1 min-w-0">
                <p id="term-source" class="text-[11px] font-black text-slate-500 uppercase mb-4 tracking-widest truncate"></p>
                <h2 id="term-result" class="text-5xl font-black italic tracking-tighter uppercase leading-tight mb-6">...</h2>
                <div class="flex gap-3">
                    <span class="bg-indigo-600/20 text-indigo-400 text-[10px] font-black px-4 py-1.5 rounded-full uppercase">+10 XP GAIN</span>
                </div>
            </div>
            <div class="flex flex-col gap-5">
                <button onclick="engine.commitWord()" class="w-24 h-24 bg-indigo-600 rounded-[35px] flex items-center justify-center text-4xl shadow-2xl shadow-indigo-600/40 hover:scale-110 active:scale-95 transition-all">
                    <i class="fa-solid fa-plus text-white"></i>
                </button>
                <button onclick="ui.hidePopup()" class="text-[10px] font-black text-slate-600 uppercase hover:text-white transition-colors">Dismiss</button>
            </div>
        </div>
    </div>

    <div id="notif-box" class="fixed top-10 right-10 z-[9999] pointer-events-none"></div>

    <script>
        /**
         * LINGOPRO ENGINE v14.0
         * MODULE-BASED ARCHITECTURE
         * FILE TARGET: user.json
         */

        // --- GLOBAL STATE ---
        const DATABASE_KEY = 'lingopro_v14_enterprise_db';
        
        let appState = {
            database: {
                user: { xp: 0, level: 1, rank: 'Neophyte' },
                lexicon: [],
                metadata: { lastSync: Date.now() }
            },
            currentTerm: { original: '', translated: '' },
            activeSelection: ''
        };

        // --- MODULE: STORAGE & I/O ---
        const storage = {
            /** * Initialize Database from LocalStorage 
             */
            init() {
                const rawData = localStorage.getItem(DATABASE_KEY);
                if (rawData) {
                    try {
                        appState.database = JSON.parse(rawData);
                    } catch (e) {
                        console.error("DB Corrupted. Resetting...");
                    }
                }
                ui.refreshGlobalStats();
            },

            /** * Persistent Save 
             */
            save() {
                localStorage.setItem(DATABASE_KEY, JSON.stringify(appState.database));
            },

            /** * Export to user.json 
             */
            downloadData() {
                const content = JSON.stringify(appState.database, null, 4);
                const blob = new Blob([content], { type: 'application/json' });
                const blobURL = URL.createObjectURL(blob);
                
                const downloader = document.createElement('a');
                downloader.href = blobURL;
                downloader.download = 'user.json'; // TÊN FILE THEO YÊU CẦU
                
                document.body.appendChild(downloader);
                downloader.click();
                document.body.removeChild(downloader);
                
                ui.notify("Dữ liệu đã được đóng gói vào user.json", "success");
            },

            /** * Import from user.json 
             */
            uploadData(event) {
                const targetFile = event.target.files[0];
                if (!targetFile) return;

                const fileReader = new FileReader();
                fileReader.onload = (e) => {
                    try {
                        const importedData = JSON.parse(e.target.result);
                        
                        // Validation logic
                        if (importedData.lexicon && importedData.user) {
                            appState.database = importedData;
                            this.save();
                            ui.notify("Đồng bộ user.json thành công!", "success");
                            setTimeout(() => location.reload(), 1000);
                        } else {
                            throw new Error("Invalid structure");
                        }
                    } catch (err) {
                        ui.notify("File user.json không hợp lệ!", "error");
                    }
                };
                fileReader.readAsText(targetFile);
            }
        };

        // --- MODULE: ROUTING & TABS ---
        const router = {
            navigate(targetID) {
                // Clear active states
                document.querySelectorAll('.pane').forEach(p => p.classList.remove('active'));
                document.querySelectorAll('.nav-link').forEach(n => n.classList.remove('active', 'text-white'));

                // Set new active
                const targetPane = document.getElementById(`pane-${targetID}`);
                const targetNav = document.querySelector(`[data-nav="${targetID}"]`);

                if (targetPane && targetNav) {
                    targetPane.classList.add('active');
                    targetNav.classList.add('active', 'text-white');
                }

                // Sub-module rendering
                if (targetID === 'lexicon') ui.renderLexiconGrid();
            }
        };

        // --- MODULE: UI & RENDERING ---
        const ui = {
            /** * Refresh XP and Level displays 
             */
            refreshGlobalStats() {
                const currentXP = appState.database.user.xp;
                const levelCalculated = Math.floor(currentXP / 100) + 1;
                const progressPercentage = currentXP % 100;

                document.getElementById('display-level').innerText = `LEVEL ${levelCalculated}`;
                document.getElementById('xp-bar-fill').style.width = `${progressPercentage}%`;
                
                // Rank logic
                let currentRank = "Neophyte";
                if (levelCalculated > 10) currentRank = "Scholar";
                if (levelCalculated > 30) currentRank = "Polyglot";
                document.getElementById('display-rank').innerText = currentRank;
            },

            /** * Render Vocabulary Cards 
             */
            renderLexiconGrid() {
                const container = document.getElementById('lexicon-container');
                const totalLabel = document.getElementById('count-total');
                
                const list = appState.database.lexicon;
                totalLabel.innerText = list.length;

                if (list.length === 0) {
                    container.innerHTML = `<div class="col-span-full py-20 text-center text-slate-600 font-bold uppercase tracking-widest">No terms saved yet</div>`;
                    return;
                }

                container.innerHTML = list.map((item, index) => `
                    <div class="card-entry group">
                        <div class="flex justify-between items-start mb-4">
                            <span class="text-[9px] font-black text-indigo-500 tracking-[0.2em] uppercase">Vocal_Entry #${list.length - index}</span>
                            <button onclick="engine.purgeWord(${index})" class="text-slate-700 hover:text-red-500 transition-colors">
                                <i class="fa-solid fa-trash-can text-xs"></i>
                            </button>
                        </div>
                        <p class="text-[10px] font-black text-slate-500 uppercase mb-1">${item.original}</p>
                        <h4 class="text-2xl font-black italic uppercase tracking-tighter truncate">${item.translated}</h4>
                    </div>
                `).join('');
            },

            /** * Show/Hide Translation Popup 
             */
            showPopup() {
                const pop = document.getElementById('translation-pop');
                pop.style.bottom = '40px';
            },

            hidePopup() {
                const pop = document.getElementById('translation-pop');
                pop.style.bottom = '-600px';
            },

            /** * Simple Notification System 
             */
            notify(msg, type = 'info') {
                const box = document.getElementById('notif-box');
                const n = document.createElement('div');
                const bgColor = type === 'success' ? 'bg-indigo-600' : 'bg-red-600';
                
                n.className = `${bgColor} px-8 py-4 rounded-2xl shadow-2xl mb-4 text-xs font-black uppercase tracking-widest animate-bounce pointer-events-auto`;
                n.innerText = msg;
                
                box.appendChild(n);
                setTimeout(() => n.remove(), 3500);
            }
        };

        // --- MODULE: TRANSLATION ENGINE ---
        const engine = {
            /** * Process raw text into interactive words 
             */
            initAnalysis() {
                const rawContent = document.getElementById('input-area').value;
                if (!rawContent.trim()) {
                    ui.notify("Vui lòng nhập văn bản nguồn!", "error");
                    return;
                }

                const outputNode = document.getElementById('content-output');
                outputNode.innerHTML = "";
                outputNode.classList.remove('opacity-10');

                const paragraphs = rawContent.split('\n');
                paragraphs.forEach(pText => {
                    if (!pText.trim()) return;
                    
                    const pElement = document.createElement('div');
                    pElement.className = 'paragraph-block mb-10';
                    
                    const tokens = pText.split(' ');
                    tokens.forEach(token => {
                        const span = document.createElement('span');
                        span.className = 'word-unit';
                        span.innerText = token + ' ';
                        
                        // Sanitize word for translation
                        const cleanWord = token.replace(/[.,!?;:()"]/g, '');
                        span.onclick = () => this.executeTranslation(cleanWord);
                        
                        pElement.appendChild(span);
                    });
                    
                    outputNode.appendChild(pElement);
                });

                ui.notify("Phân tích hoàn tất", "success");
            },

            /** * Call Google Translate API 
             */
            async executeTranslation(query) {
                if (!query) return;

                document.getElementById('term-source').innerText = query;
                document.getElementById('term-result').innerText = "Analyzing...";
                ui.showPopup();

                try {
                    const apiURL = `https://translate.googleapis.com/translate_a/single?client=gtx&sl=en&tl=vi&dt=t&q=${encodeURIComponent(query)}`;
                    const response = await fetch(apiURL);
                    const data = await response.json();
                    
                    const result = data[0][0][0];
                    document.getElementById('term-result').innerText = result;
                    
                    appState.currentTerm = {
                        original: query,
                        translated: result
                    };
                } catch (error) {
                    document.getElementById('term-result').innerText = "SYNC ERROR";
                    ui.notify("Lỗi kết nối API dịch thuật", "error");
                }
            },

            /** * Smart Phrase Translation from Selection 
             */
            translatePhrase() {
                this.executeTranslation(appState.activeSelection);
                window.getSelection().removeAllRanges();
                document.getElementById('smart-tooltip').style.display = 'none';
            },

            /** * Save term to Lexicon 
             */
            commitWord() {
                const word = appState.currentTerm;
                
                // Avoid duplicates
                const isExists = appState.database.lexicon.some(x => x.original.toLowerCase() === word.original.toLowerCase());
                if (isExists) {
                    ui.notify("Từ này đã có trong Lexicon!", "info");
                    ui.hidePopup();
                    return;
                }

                appState.database.lexicon.unshift({...word});
                appState.database.user.xp += 10;
                
                storage.save();
                ui.refreshGlobalStats();
                ui.hidePopup();
                ui.notify(`Saved: ${word.original}`, "success");
            },

            /** * Remove term 
             */
            purgeWord(idx) {
                appState.database.lexicon.splice(idx, 1);
                storage.save();
                ui.renderLexiconGrid();
                ui.notify("Đã xóa mục từ vựng", "info");
            }
        };

        // --- SYSTEM INITIALIZATION & EVENT LISTENERS ---
        
        /** * Handle Selection Events for Smart Phrase Tooltip 
         */
        window.addEventListener('selectionchange', () => {
            const selection = window.getSelection();
            const selectedText = selection.toString().trim();
            const tooltip = document.getElementById('smart-tooltip');

            if (selectedText.length > 1) {
                const range = selection.getRangeAt(0);
                const rect = range.getBoundingClientRect();
                
                tooltip.style.display = 'block';
                tooltip.style.top = `${rect.top + window.scrollY - 55}px`;
                tooltip.style.left = `${rect.left}px`;
                appState.activeSelection = selectedText;
            } else {
                tooltip.style.display = 'none';
            }
        });

        /** * Keyboard Shortcuts 
         */
        window.addEventListener('keydown', (e) => {
            // F8 to Process
            if (e.key === 'F8') {
                e.preventDefault();
                engine.initAnalysis();
            }
        });

        /** * Bootup Sequence 
         */
        window.onload = () => {
            storage.init();
            console.log("LingoPro Enterprise System Online. Target: user.json");
        };

    </script>
</body>
</html>
