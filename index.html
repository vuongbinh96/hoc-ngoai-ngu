<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LingoPro - ƒê∆°n Gi·∫£n L√† Nh·∫•t</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        body { background: #0f172a; font-family: 'Inter', sans-serif; color: white; height: 100vh; overflow: hidden; }
        
        /* Ch·ªØ c·ªßa danh s√°ch ng√¥n ng·ªØ l√† m√†u ƒëen */
        #tts-lang {
            background-color: white !important;
            color: black !important;
            border-radius: 8px;
            padding: 5px 10px;
            font-weight: bold;
            outline: none;
            border: 2px solid #ef4444;
        }
        #tts-lang option { color: black; background: white; }

        .lyric-card { background: white; border-radius: 20px; padding: 20px; margin-bottom: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.3); }
        .source-word { 
            font-size: 1.3rem; font-weight: 700; color: #1e293b; 
            cursor: pointer; padding: 0 2px; transition: 0.1s; display: inline-block;
        }
        .source-word:hover { color: #ef4444; background: #fee2e2; border-radius: 4px; }
        
        #translate-popup {
            position: fixed; bottom: -200px; left: 50%; transform: translateX(-50%);
            width: 90%; max-width: 400px; background: white; color: #1e293b; padding: 20px;
            border-radius: 25px; display: flex; align-items: center; justify-content: space-between;
            box-shadow: 0 10px 40px rgba(0,0,0,0.6); transition: 0.3s cubic-bezier(0.18, 0.89, 0.32, 1.28); 
            z-index: 1000; border: 3px solid #ef4444;
        }
        #translate-popup.active { bottom: 30px; }
        #lyric-display { height: calc(100vh - 150px); overflow-y: auto; padding: 10px; }
    </style>
</head>
<body class="p-4 md:p-8">

    <header class="flex justify-between items-center mb-6">
        <h1 class="text-2xl font-black italic">LINGO<span class="text-red-500">PRO</span></h1>
        <select id="tts-lang">
            <option value="en-US">Ti·∫øng Anh</option>
            <option value="ko-KR">Ti·∫øng H√†n</option>
            <option value="ja-JP">Ti·∫øng Nh·∫≠t</option>
            <option value="zh-CN">Ti·∫øng Trung</option>
            <option value="fr-FR">Ti·∫øng Ph√°p</option>
        </select>
    </header>

    <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
        <div class="lg:col-span-4 space-y-4">
            <div id="player-container" class="rounded-2xl overflow-hidden aspect-video bg-black shadow-2xl">
                <div id="player"></div>
            </div>
            <input type="text" id="yt-url" placeholder="D√°n link Youtube t·∫°i ƒë√¢y..." class="w-full p-3 rounded-xl bg-slate-800 border border-slate-700 text-white outline-none">
            <textarea id="lyric-input" rows="5" class="w-full p-3 rounded-xl bg-slate-800 border border-slate-700 text-white outline-none" placeholder="D√°n l·ªùi b√†i h√°t v√†o ƒë√¢y..."></textarea>
            <button onclick="initApp()" class="w-full bg-red-600 py-4 rounded-xl font-black uppercase shadow-xl hover:bg-red-500 transition">üöÄ B·∫ÆT ƒê·∫¶U H·ªåC</button>
        </div>

        <div class="lg:col-span-8">
            <div id="lyric-display">
                <div class="h-full flex flex-col items-center justify-center opacity-20">
                    <p class="text-xl font-bold">D√°n link & Lyrics r·ªìi b·∫•m n√∫t m√†u ƒë·ªè nh√©!</p>
                </div>
            </div>
        </div>
    </div>

    <div id="translate-popup">
        <div class="flex-1">
            <p id="pop-src" class="text-xs font-black text-slate-400 uppercase mb-1">WORD</p>
            <p id="pop-vi" class="text-2xl font-black text-red-600 leading-tight">ƒêang d·ªãch...</p>
        </div>
        <button onclick="speak()" class="w-14 h-14 bg-red-500 text-white rounded-full flex items-center justify-center text-xl shadow-lg active:scale-90 transition">
            <i class="fa-solid fa-volume-high"></i>
        </button>
    </div>

    <script src="https://www.youtube.com/iframe_api"></script>
    <script>
        let player, popupTimer;

        function extractId(url) {
            const m = url.match(/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/);
            return (m && m[2].length == 11) ? m[2] : false;
        }

        async function translate(word) {
            try {
                const res = await fetch(`https://translate.googleapis.com/translate_a/single?client=gtx&sl=auto&tl=vi&dt=t&q=${encodeURIComponent(word)}`);
                const data = await res.json();
                return data[0][0][0];
            } catch (e) { return "L·ªói d·ªãch!"; }
        }

        function initApp() {
            const lyrics = document.getElementById('lyric-input').value;
            const ytUrl = document.getElementById('yt-url').value;

            if(!lyrics) return alert("Nh·∫≠p l·ªùi b√†i h√°t tr∆∞·ªõc ƒë√£!");

            const vid = extractId(ytUrl);
            if(vid) {
                if(player) player.loadVideoById(vid);
                else player = new YT.Player('player', { videoId: vid, width: '100%', height: '100%' });
            }
            render(lyrics);
        }

        function render(text) {
            const container = document.getElementById('lyric-display');
            container.innerHTML = "";
            text.split('\n').filter(l => l.trim()).forEach(line => {
                const card = document.createElement('div');
                card.className = 'lyric-card';
                
                line.split(/(\s+)/).forEach(token => {
                    if(/\s+/.test(token)) {
                        card.appendChild(document.createTextNode(token));
                    } else {
                        const span = document.createElement('span');
                        span.className = 'source-word';
                        span.innerText = token;
                        span.onclick = async () => {
                            const clean = token.replace(/[.,!?;:'"‚Äú‚Äù]/g, "");
                            showPopup(clean);
                        };
                        card.appendChild(span);
                    }
                });
                container.appendChild(card);
            });
        }

        async function showPopup(word) {
            const pop = document.getElementById('translate-popup');
            document.getElementById('pop-src').innerText = word;
            document.getElementById('pop-vi').innerText = "ƒêang tra...";
            pop.classList.add('active');

            const result = await translate(word);
            document.getElementById('pop-vi').innerText = result;

            if(popupTimer) clearTimeout(popupTimer);
            popupTimer = setTimeout(() => pop.classList.remove('active'), 5000);
        }

        function speak() {
            const txt = document.getElementById('pop-src').innerText;
            const utter = new SpeechSynthesisUtterance(txt);
            utter.lang = /[\uAC00-\uD7A3]/.test(txt) ? 'ko-KR' : document.getElementById('tts-lang').value;
            window.speechSynthesis.speak(utter);
        }
    </script>
</body>
</html>
