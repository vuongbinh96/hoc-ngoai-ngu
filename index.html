<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LingoPro Full Languages Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        body { background: #0f172a; font-family: 'Inter', sans-serif; color: white; height: 100vh; overflow: hidden; }
        
        /* Dropdown Ng√¥n ng·ªØ - Ch·ªØ ƒëen chu·∫©n */
        #tts-lang {
            background-color: white !important;
            color: black !important;
            border-radius: 10px; padding: 6px 12px; font-weight: 800; outline: none; border: 2px solid #ef4444;
            max-width: 150px; cursor: pointer;
        }
        #tts-lang option { color: black !important; background: white !important; }

        .lyric-card { background: white; border-radius: 20px; padding: 20px; margin-bottom: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.3); }
        .source-word { 
            font-size: 1.3rem; font-weight: 700; color: #1e293b; 
            cursor: pointer; padding: 0 2px; transition: 0.1s; display: inline-block;
        }
        .source-word:hover { color: #ef4444; background: #fee2e2; border-radius: 4px; }
        
        #translate-popup {
            position: fixed; bottom: -200px; left: 50%; transform: translateX(-50%);
            width: 90%; max-width: 400px; background: white; color: #1e293b; padding: 20px;
            border-radius: 25px; display: flex; align-items: center; justify-content: space-between;
            box-shadow: 0 10px 40px rgba(0,0,0,0.6); transition: 0.3s cubic-bezier(0.18, 0.89, 0.32, 1.28); 
            z-index: 1000; border: 3px solid #ef4444;
        }
        #translate-popup.active { bottom: 30px; }
        #lyric-display { height: calc(100vh - 160px); overflow-y: auto; padding: 10px; }

        #quiz-overlay { display: none; position: fixed; inset: 0; background: rgba(15,23,42,0.98); z-index: 2000; align-items: center; justify-content: center; backdrop-filter: blur(10px); }
        .quiz-box { background: white; width: 90%; max-width: 450px; padding: 30px; border-radius: 30px; color: #1e293b; text-align: center; }
        .opt-btn { width: 100%; padding: 15px; margin-top: 10px; border: 2px solid #f1f5f9; border-radius: 15px; font-weight: 700; transition: 0.2s; }
        .opt-btn:hover { background: #eff6ff; border-color: #3b82f6; }
    </style>
</head>
<body class="p-4 md:p-8">

    <header class="flex justify-between items-center mb-6">
        <h1 class="text-2xl font-black italic">LINGO<span class="text-red-500">PRO</span></h1>
        <div class="flex items-center gap-2">
            <select id="tts-lang">
                <option value="en-US">English (US)</option>
                <option value="ko-KR">Korean (ÌïúÍµ≠Ïñ¥)</option>
                <option value="ja-JP">Japanese (Êó•Êú¨Ë™û)</option>
                <option value="zh-CN">Chinese (‰∏≠Êñá)</option>
                <option value="fr-FR">French (Fran√ßais)</option>
                <option value="de-DE">German (Deutsch)</option>
                <option value="es-ES">Spanish (Espa√±ol)</option>
                <option value="ru-RU">Russian (–†—É—Å—Å–∫–∏–π)</option>
                <option value="th-TH">Thai (‡πÑ‡∏ó‡∏¢)</option>
                <option value="it-IT">Italian (Italiano)</option>
                <option value="pt-PT">Portuguese</option>
                <option value="ar-SA">Arabic</option>
                <option value="vi-VN">Vietnamese</option>
            </select>
            <button onclick="startQuiz()" class="bg-red-500 text-white px-4 py-2 rounded-full font-black text-xs shadow-lg">V√ÄO THI</button>
        </div>
    </header>

    <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
        <div class="lg:col-span-4 space-y-4">
            <div id="player-container" class="rounded-2xl overflow-hidden aspect-video bg-black shadow-2xl">
                <div id="player"></div>
            </div>
            <input type="text" id="yt-url" placeholder="D√°n link Youtube..." class="w-full p-3 rounded-xl bg-slate-800 border border-slate-700 text-white outline-none">
            <textarea id="lyric-input" rows="5" class="w-full p-3 rounded-xl bg-slate-800 border border-slate-700 text-white outline-none" placeholder="D√°n Lyrics b√†i h√°t..."></textarea>
            <button onclick="initApp()" class="w-full bg-blue-600 py-4 rounded-xl font-black uppercase shadow-xl hover:bg-blue-500 transition">üöÄ N·∫†P B√ÄI H·ªåC</button>
        </div>

        <div class="lg:col-span-8">
            <div id="lyric-display">
                <div class="h-full flex flex-col items-center justify-center opacity-20">
                    <i class="fa-solid fa-microphone-lines text-6xl mb-4"></i>
                    <p class="text-xl font-bold">H√£y n·∫°p b√†i ƒë·ªÉ b·∫Øt ƒë·∫ßu d·ªãch t·ª´ng t·ª´!</p>
                </div>
            </div>
        </div>
    </div>

    <div id="translate-popup">
        <div class="flex-1">
            <p id="pop-src" class="text-xs font-black text-slate-400 uppercase">WORD</p>
            <p id="pop-vi" class="text-2xl font-black text-red-600">D·ªãch...</p>
        </div>
        <button onclick="speak()" class="w-12 h-12 bg-red-500 text-white rounded-full flex items-center justify-center text-xl shadow-lg">
            <i class="fa-solid fa-volume-high"></i>
        </button>
    </div>

    <div id="quiz-overlay">
        <div class="quiz-box shadow-2xl">
            <div id="quiz-content">
                <div class="flex justify-between mb-4 text-[10px] font-bold text-slate-400">
                    <span id="quiz-progress">C√ÇU 1/10</span>
                    <span>THI T·ª™ V·ª∞NG</span>
                </div>
                <h2 id="quiz-question" class="text-3xl font-black mb-8 text-slate-800">Word</h2>
                <div id="quiz-options"></div>
            </div>
            <div id="quiz-result" class="hidden">
                <p class="text-sm font-bold text-slate-400">K·∫æT QU·∫¢ C·ª¶A B·∫†N</p>
                <h2 class="text-6xl font-black text-blue-600 mb-6" id="quiz-score">0/10</h2>
                <button onclick="closeQuiz()" class="w-full bg-slate-900 text-white py-4 rounded-xl font-bold">THO√ÅT</button>
            </div>
        </div>
    </div>

    <script src="https://www.youtube.com/iframe_api"></script>
    <script>
        let player, popupTimer, quizWords = [], currentQ = 0, score = 0, learnedList = [];

        function extractId(url) {
            const m = url.match(/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/);
            return (m && m[2].length == 11) ? m[2] : false;
        }

        async function translate(word) {
            try {
                const res = await fetch(`https://translate.googleapis.com/translate_a/single?client=gtx&sl=auto&tl=vi&dt=t&q=${encodeURIComponent(word)}`);
                const data = await res.json();
                return data[0][0][0];
            } catch (e) { return "L·ªói"; }
        }

        function initApp() {
            const lyrics = document.getElementById('lyric-input').value;
            const ytUrl = document.getElementById('yt-url').value;
            if(!lyrics) return alert("Nh·∫≠p l·ªùi b√†i h√°t tr∆∞·ªõc!");

            const vid = extractId(ytUrl);
            if(vid) {
                if(player) player.loadVideoById(vid);
                else player = new YT.Player('player', { videoId: vid, width: '100%', height: '100%' });
            }
            render(lyrics);
        }

        function render(text) {
            const container = document.getElementById('lyric-display');
            container.innerHTML = "";
            text.split('\n').filter(l => l.trim()).forEach(line => {
                const card = document.createElement('div');
                card.className = 'lyric-card';
                line.split(/(\s+)/).forEach(token => {
                    if(/\s+/.test(token)) {
                        card.appendChild(document.createTextNode(token));
                    } else {
                        const span = document.createElement('span');
                        span.className = 'source-word';
                        span.innerText = token;
                        span.onclick = async () => {
                            const clean = token.replace(/[.,!?;:'"‚Äú‚Äù]/g, "");
                            const res = await showPopup(clean);
                            if(!learnedList.find(i => i.q === clean)) learnedList.push({q: clean, a: res});
                        };
                        card.appendChild(span);
                    }
                });
                container.appendChild(card);
            });
        }

        async function showPopup(word) {
            const pop = document.getElementById('translate-popup');
            document.getElementById('pop-src').innerText = word;
            document.getElementById('pop-vi').innerText = "Tra t·ª´...";
            pop.classList.add('active');
            const result = await translate(word);
            document.getElementById('pop-vi').innerText = result;
            if(popupTimer) clearTimeout(popupTimer);
            popupTimer = setTimeout(() => pop.classList.remove('active'), 5000);
            return result;
        }

        function speak() {
            const txt = document.getElementById('pop-src').innerText;
            const utter = new SpeechSynthesisUtterance(txt);
            utter.lang = /[\uAC00-\uD7A3]/.test(txt) ? 'ko-KR' : document.getElementById('tts-lang').value;
            window.speechSynthesis.speak(utter);
        }

        function startQuiz() {
            if(learnedList.length < 4) return alert("H√£y tra √≠t nh·∫•t 4 t·ª´ ƒë·ªÉ b·∫Øt ƒë·∫ßu thi!");
            quizWords = [...learnedList].sort(() => 0.5 - Math.random()).slice(0, 10);
            currentQ = 0; score = 0;
            document.getElementById('quiz-overlay').style.display = 'flex';
            document.getElementById('quiz-content').classList.remove('hidden');
            document.getElementById('quiz-result').classList.add('hidden');
            showQuestion();
        }

        function showQuestion() {
            if(currentQ >= quizWords.length) return showFinalResult();
            const item = quizWords[currentQ];
            document.getElementById('quiz-progress').innerText = `C√ÇU ${currentQ + 1}/${quizWords.length}`;
            document.getElementById('quiz-question').innerText = item.q;
            
            let options = [item.a];
            let otherWords = learnedList.filter(i => i.a !== item.a);
            while(options.length < 4 && otherWords.length > 0) {
                let rand = otherWords[Math.floor(Math.random()*otherWords.length)].a;
                if(!options.includes(rand)) options.push(rand);
            }

            const optContainer = document.getElementById('quiz-options');
            optContainer.innerHTML = "";
            options.sort(() => 0.5 - Math.random()).forEach(opt => {
                const btn = document.createElement('button');
                btn.className = 'opt-btn'; btn.innerText = opt;
                btn.onclick = () => {
                    if(opt === item.a) score++;
                    currentQ++; showQuestion();
                };
                optContainer.appendChild(btn);
            });
        }

        function showFinalResult() {
            document.getElementById('quiz-content').classList.add('hidden');
            document.getElementById('quiz-result').classList.remove('hidden');
            document.getElementById('quiz-score').innerText = `${score}/${quizWords.length}`;
        }
        function closeQuiz() { document.getElementById('quiz-overlay').style.display = 'none'; }
    </script>
</body>
</html>
